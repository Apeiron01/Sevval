<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>üíú √ñzel Alb√ºm</title>

  <style>
    :root{
      --bg1:#d9c7ff;
      --bg2:#cdb7ff;
      --card:#ffffffcc;
      --ink:#2a1638;
      --muted:#513465;
      --shadow: 0 18px 60px rgba(24, 10, 40, .18);
      --radius: 18px;

      /* Album 3D */
      --ringZ: 250px;        /* translateZ for slides (responsive updated in JS) */
      --slideW: 260px;       /* slide card width (responsive updated in JS) */
      --slideH: 340px;       /* slide card height (responsive updated in JS) */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at 15% 10%, #fff8, transparent 60%),
        radial-gradient(900px 500px at 85% 35%, #fff6, transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2) 65%, #c2abff);
      overflow:hidden;
    }

    /* Background hearts (stable shape) */
    .bg-hearts{ position:fixed; inset:0; pointer-events:none; z-index:0; opacity:.75; }
    .bg-heart{
      position:absolute;
      width:14px; height:14px;
      transform: rotate(-45deg);
      background: rgba(255,255,255,.55);
      border-radius: 3px;
      will-change: transform, opacity;
      animation: floatUp var(--dur) linear forwards;
      filter: blur(.1px);
    }
    .bg-heart::before,.bg-heart::after{
      content:"";
      position:absolute;
      width:14px; height:14px;
      background: rgba(255,255,255,.55);
      border-radius: 50%;
    }
    .bg-heart::before{top:-50%; left:0}
    .bg-heart::after{left:50%; top:0}
    @keyframes floatUp{
      0%   { transform: translate3d(0, 10vh, 0) rotate(-45deg) scale(.9); opacity:0 }
      12%  { opacity:.9 }
      100% { transform: translate3d(var(--drift), -120vh, 0) rotate(-45deg) scale(1.15); opacity:0 }
    }

    .app{
      position:relative;
      z-index:1;
      height:100%;
      display:grid;
      place-items:center;
      padding: clamp(12px, 2.5vw, 22px);
    }
    .panel{
      width:min(980px, 100%);
      background: var(--card);
      border: 1px solid rgba(42,22,56,.10);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }
    .panel::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(800px 200px at 20% 0%, rgba(255,255,255,.65), transparent 60%),
        radial-gradient(800px 240px at 80% 15%, rgba(255,255,255,.45), transparent 55%);
      pointer-events:none;
    }
    .panel-inner{ position:relative; padding: clamp(14px, 2.2vw, 26px); }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: clamp(12px, 2.2vw, 18px) clamp(14px, 2.4vw, 22px);
      border-bottom: 1px solid rgba(42,22,56,.10);
      background: rgba(246,241,255,.65);
    }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px; }
    .pill{
      font-size:12px;
      padding: 6px 10px;
      border-radius:999px;
      background: rgba(42,22,56,.08);
      color: var(--muted);
      border:1px solid rgba(42,22,56,.10);
      white-space:nowrap;
    }

    .screen{ display:none; }
    .screen.active{ display:block; }

    .grid{ display:grid; gap:14px; }
    @media (min-width: 860px){
      .grid.two{ grid-template-columns: 1.15fr .85fr; align-items:start; }
    }

    .card{
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(42,22,56,.10);
      border-radius: 16px;
      padding: clamp(14px, 2vw, 18px);
      box-shadow: 0 10px 28px rgba(24,10,40,.08);
    }

    h1,h2{margin:0 0 10px 0}
    h1{font-size:clamp(20px, 3.2vw, 26px)}
    h2{font-size:18px}
    p{margin:0 0 10px 0; color: var(--muted); line-height:1.5}
    .note{ font-size:12px; color: rgba(81,52,101,.85); }

    .field{ display:grid; gap:10px; margin-top: 10px; }
    label{ font-weight:750; color: var(--ink); font-size: 13px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    input[type="text"]{
      flex: 1 1 260px;
      min-width: 160px;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(42,22,56,.18);
      background: rgba(255,255,255,.9);
      color: var(--ink);
      outline:none;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
    }
    input::placeholder{color: rgba(81,52,101,.55)}

    .btn{
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(42,22,56,.16);
      background: rgba(42,22,56,.92);
      color: #fff;
      font-weight:800;
      cursor:pointer;
      transition: transform .06s ease, filter .2s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:active{ transform: translateY(1px) scale(.99) }
    .btn.secondary{
      background: rgba(255,255,255,.78);
      color: var(--ink);
    }

    .fade-in{ animation: fadeIn .35s ease both; }
    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }

    /* Loader page */
    .loader-wrap{
      min-height: min(58vh, 520px);
      display:grid;
      place-items:center;
      text-align:center;
      padding: 16px;
      position:relative;
      overflow:hidden;
    }
    .warning{
      font-weight:900;
      letter-spacing:.4px;
      color: rgba(42,22,56,.96);
      margin-top: 14px;
      font-size: 14px;
      text-transform: uppercase;
    }
    .sub{ color: rgba(81,52,101,.9); font-size: 13px; }

    /* From Uiverse.io by FWDJc */
    .loader {
      width: 7em;
      height: 5em;
      position: relative;
      animation: beat 1s infinite;
      margin: 0 auto;
    }
    .loader::before,
    .loader::after {
      content: "";
      position: absolute;
      top: 0;
      width: 50px;
      height: 80px;
      border-radius: 5em 5em 0 0;
      animation: coldblue 1s infinite;
    }
    .loader::before {
      left: 50px;
      transform: rotate(-45deg);
      transform-origin: 0 100%;
    }
    .loader::after {
      left: 0;
      transform: rotate(45deg);
      transform-origin: 100% 100%;
    }
    @keyframes beat {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    @keyframes coldblue {
      0%, 100% { background-color: rgb(255, 255, 255); }
      50% { background-color: rgb(198, 23, 23); }
    }

    /* Minigame */
    .game{ min-height: min(66vh, 640px); position:relative; overflow:hidden; }
    .hud{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .kpi{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .kpi .chip{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(42,22,56,.08);
      border: 1px solid rgba(42,22,56,.10);
      font-size: 12px;
      color: rgba(42,22,56,.92);
      font-weight:900;
    }
    .game-instructions{
      font-weight:900;
      color: rgba(42,22,56,.92);
      margin: 0 0 10px 0;
    }
    .stage-toast{
      position:absolute;
      left:50%; top:18px;
      transform: translateX(-50%);
      background: rgba(42,22,56,.92);
      color:#fff;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 14px 40px rgba(24,10,40,.22);
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      max-width: min(560px, 92%);
      text-align:center;
      font-weight:900;
      font-size: 13px;
    }
    .stage-toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(6px);
    }
    .heart-field{
      position:relative;
      height: min(46vh, 460px);
      border-radius: 16px;
      background:
        radial-gradient(500px 220px at 20% 10%, rgba(255,255,255,.75), transparent 60%),
        radial-gradient(480px 220px at 85% 30%, rgba(255,255,255,.55), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.25));
      border: 1px solid rgba(42,22,56,.12);
      overflow:hidden;
    }

    /* From Uiverse.io by catraco */
    .heart-container {
      --heart-color: rgb(255, 91, 239);
      position: absolute;
      width: 52px;
      height: 52px;
      transition: .2s;
      filter: drop-shadow(0 10px 18px rgba(24,10,40,.12));
      will-change: transform;
    }
    .heart-container:hover{ transform: translateY(-1px) scale(1.03); }
    .heart-container .checkbox {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0;
      z-index: 20;
      cursor: pointer;
    }
    .heart-container .svg-container {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .heart-container .svg-outline,
    .heart-container .svg-filled {
      fill: var(--heart-color);
      position: absolute;
    }
    .heart-container .svg-filled {
      animation: keyframes-svg-filled 1s;
      display: none;
    }
    .heart-container .svg-celebrate {
      position: absolute;
      animation: keyframes-svg-celebrate .5s;
      animation-fill-mode: forwards;
      display: none;
      stroke: var(--heart-color);
      fill: var(--heart-color);
      stroke-width: 2px;
    }
    .heart-container .checkbox:checked~.svg-container .svg-filled { display: block }
    .heart-container .checkbox:checked~.svg-container .svg-celebrate { display: block }
    @keyframes keyframes-svg-filled {
      0% { transform: scale(0); }
      25% { transform: scale(1.2); }
      50% { transform: scale(1); filter: brightness(1.5); }
    }
    @keyframes keyframes-svg-celebrate {
      0% { transform: scale(0); }
      50% { opacity: 1; filter: brightness(1.5); }
      100% { transform: scale(1.4); opacity: 0; display: none; }
    }

    /* Album 3D: separate cards (no overlap) */
    .album{
      min-height: min(70vh, 720px);
      display:grid;
      gap: 14px;
      align-items:center;
    }
    .love-title{ text-align:center; padding: 6px 6px 0; }
    .love-title h1{ font-size: clamp(22px, 4vw, 30px); margin-bottom: 6px; }
    .love-title p{ margin: 0; color: rgba(81,52,101,.92); font-weight:800; }

    .carousel-wrap{ display:grid; place-items:center; padding: 10px 0 6px; }
    .carousel-scene{
      width: min(92vw, 720px);
      height: calc(var(--slideH) + 60px);
      display:grid;
      place-items:center;
      perspective: 1100px;
      perspective-origin: 50% 45%;
      overflow: visible;
    }
    .carousel{
      width: var(--slideW);
      height: var(--slideH);
      position:relative;
      transform-style: preserve-3d;
      animation: spin 18s linear infinite;
      will-change: transform;
    }
    .carousel:hover{ animation-play-state: paused; }
    @keyframes spin{
      from{ transform: rotateY(0deg); }
      to{ transform: rotateY(360deg); }
    }

    .slide{
      position:absolute;
      left: 50%;
      top: 50%;
      width: var(--slideW);
      height: var(--slideH);
      transform-style: preserve-3d;
      transform: translate(-50%, -50%) rotateY(var(--ry)) translateZ(var(--ringZ));
    }

    /* Distinct card per photo */
    .photo-card{
      width: 100%;
      height: 100%;
      border-radius: 18px;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(42,22,56,.16);
      box-shadow: 0 18px 50px rgba(24,10,40,.18);
      overflow:hidden;
      display:grid;
      grid-template-rows: 1fr auto;
    }
    .photo-card img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      background: rgba(255,255,255,.6);
    }
    .photo-cap{
      padding: 10px 12px;
      font-size: 12px;
      color: rgba(81,52,101,.92);
      font-weight:900;
      text-align:center;
      border-top: 1px solid rgba(42,22,56,.10);
      background: rgba(246,241,255,.65);
    }

    /* Wrong answer overlay */
    .overlay{
      position:fixed; inset:0;
      background: rgba(12, 6, 18, .72);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 14px;
      z-index: 50;
    }
    .overlay.show{ display:flex; }
    .overlay-card{
      width: min(920px, 100%);
      background: rgba(255,255,255,.92);
      border-radius: 18px;
      border: 1px solid rgba(42,22,56,.18);
      box-shadow: 0 26px 80px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .overlay-head{
      display:flex; justify-content:space-between; align-items:center;
      padding: 12px 14px;
      background: rgba(246,241,255,.9);
      border-bottom: 1px solid rgba(42,22,56,.12);
    }
    .overlay-head b{ color: rgba(42,22,56,.92); }
    .overlay-body{ padding: 14px; }
    video{
      width:100%;
      max-height: 60vh;
      border-radius: 14px;
      border: 1px solid rgba(42,22,56,.14);
      background:#000;
    }

    /* Mobile tweaks */
    @media (max-width: 520px){
      .pill{ display:none; }
      .row{ gap:8px; }
      .btn{ width:100%; }
      input[type="text"]{ width:100%; flex-basis: 100%; }
      .heart-field{ height: min(44vh, 420px); }
    }
  </style>
</head>

<body>
  <div class="bg-hearts" id="bgHearts" aria-hidden="true"></div>

  <div class="app">
    <div class="panel">
      <div class="topbar">
        <div class="brand">
          <span aria-hidden="true">üíú</span>
          <span>Sevgililer G√ºn√º √ñzel</span>
        </div>
        <div class="pill" id="statusPill">Tek sayfa ‚Ä¢ HTML/CSS/JS</div>
      </div>

      <div class="panel-inner">

        <!-- SCREEN 1 -->
        <section class="screen active fade-in" id="screen-pass-1">
          <div class="grid two">
            <div class="card">
              <h1>Giri≈ü Doƒürulama</h1>
              <p>Bu i√ßerik, kontroll√º eri≈üimle √ßalƒ±≈üƒ±r. Soruyu yanƒ±tlayƒ±p devam edebilirsin.</p>

              <div class="field">
                <label for="q1">Soru: <b>Taha ne zaman kaza yapmƒ±≈ütƒ±r?</b></label>
                <div class="row">
                  <input id="q1" type="text" autocomplete="off" placeholder="Cevabƒ± yaz" />
                  <button class="btn" id="btnQ1">Doƒürula</button>
                </div>
                <div class="note">Yanlƒ±≈ü cevapta video ekranƒ± a√ßƒ±lƒ±r.</div>
              </div>
            </div>

            <div class="card">
              <h2>Not</h2>
              <p>Doƒüru cevapta kƒ±sa bir y√ºkleme ekranƒ±ndan sonra mini-game ba≈ülar.</p>
              <p class="note">Repo yapƒ±sƒ±: <b>index.html</b> + aynƒ± klas√∂rde <b>video.mp4</b> ve <b>photo1.jpeg..photo6.jpeg</b></p>
            </div>
          </div>
        </section>

        <!-- SCREEN 2: LOADER -->
        <section class="screen fade-in" id="screen-loader">
          <div class="loader-wrap card">
            <div>
              <div class="loader" aria-hidden="true"></div>
              <div class="warning">‚ö†Ô∏è‚ö†Ô∏è BU Sƒ∞TE SADECE TEK Kƒ∞≈ûƒ∞YE √ñZELDƒ∞R ‚ö†Ô∏è‚ö†Ô∏è</div>
              <div class="sub">Y√ºkleniyor... Kalpler hazƒ±rlanƒ±yor.</div>
            </div>
          </div>
        </section>

        <!-- SCREEN 3: GAME -->
        <section class="screen fade-in" id="screen-game">
          <div class="card game">
            <div class="hud">
              <div>
                <div class="game-instructions">
                  Sayfadaki <b>tƒ±klanabilir kalplerin hepsine</b> bas.
                </div>
                <p class="note">Kalpler rastgele olu≈üur. Hepsine basƒ±nca bir sonraki a≈üamaya ge√ßer.</p>
              </div>

              <div class="kpi">
                <div class="chip">A≈üama: <span id="stageLabel">1</span>/3</div>
                <div class="chip">Toplam tƒ±klama: <span id="totalClicks">0</span></div>
              </div>
            </div>

            <div class="stage-toast" id="toast"></div>
            <div class="heart-field" id="heartField" aria-label="Kalp alanƒ±"></div>

            <div class="row" style="margin-top:12px; justify-content:space-between">
              <button class="btn secondary" id="btnResetGame" type="button">Mini-game Sƒ±fƒ±rla</button>
            </div>
          </div>
        </section>

        <!-- SCREEN 4: PASS 2 -->
        <section class="screen fade-in" id="screen-pass-2">
          <div class="grid">
            <div class="card">
              <h1>ƒ∞kinci Doƒürulama</h1>
              <p>Soru: <b>Ka√ß kalbe bastƒ±ƒüƒ±nƒ±, aralarƒ±na nokta koyarak sƒ±rayla yaz.</b></p>

              <div class="field">
                <label for="q2">Cevap</label>
                <div class="row">
                  <input id="q2" type="text" autocomplete="off" placeholder="Cevabƒ± noktayla ayƒ±rarak yaz" />
                  <button class="btn" id="btnQ2">Doƒürula</button>
                </div>
                <div class="note" id="q2Hint">ƒ∞pucu: 3 a≈üamadaki tƒ±klamalarƒ± sƒ±rayla yaz.</div>
              </div>
            </div>
          </div>
        </section>

        <!-- SCREEN 5: ALBUM -->
        <section class="screen fade-in" id="screen-album">
          <div class="album">
            <div class="love-title">
              <h1>Sevgilim seni √ßok seviyorum.</h1>
              <p>ƒ∞yi ki benim sevgilimsin.</p>
            </div>

            <div class="carousel-wrap">
              <div class="carousel-scene">
                <div class="carousel" id="carousel" aria-label="3D Fotoƒüraf Alb√ºm√º">
                  <div class="slide" style="--ry:0deg">
                    <div class="photo-card">
                      <img src="photo1.jpeg" alt="Fotoƒüraf 1" />
                      <div class="photo-cap">Fotoƒüraf 1</div>
                    </div>
                  </div>
                  <div class="slide" style="--ry:60deg">
                    <div class="photo-card">
                      <img src="photo2.jpeg" alt="Fotoƒüraf 2" />
                      <div class="photo-cap">Fotoƒüraf 2</div>
                    </div>
                  </div>
                  <div class="slide" style="--ry:120deg">
                    <div class="photo-card">
                      <img src="photo3.jpeg" alt="Fotoƒüraf 3" />
                      <div class="photo-cap">Fotoƒüraf 3</div>
                    </div>
                  </div>
                  <div class="slide" style="--ry:180deg">
                    <div class="photo-card">
                      <img src="photo4.jpeg" alt="Fotoƒüraf 4" />
                      <div class="photo-cap">Fotoƒüraf 4</div>
                    </div>
                  </div>
                  <div class="slide" style="--ry:240deg">
                    <div class="photo-card">
                      <img src="photo5.jpeg" alt="Fotoƒüraf 5" />
                      <div class="photo-cap">Fotoƒüraf 5</div>
                    </div>
                  </div>
                  <div class="slide" style="--ry:300deg">
                    <div class="photo-card">
                      <img src="photo6.jpeg" alt="Fotoƒüraf 6" />
                      <div class="photo-cap">Fotoƒüraf 6</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card" style="text-align:center">
              <p class="note" style="margin:0">
                Alb√ºm otomatik d√∂ner. √úzerine gelince durur.
              </p>
            </div>
          </div>
        </section>

      </div>
    </div>
  </div>

  <!-- Wrong answer video overlay -->
  <div class="overlay" id="overlay">
    <div class="overlay-card">
      <div class="overlay-head">
        <b>Doƒürulama Ba≈üarƒ±sƒ±z</b>
        <button class="btn secondary" id="btnCloseOverlay" type="button">Kapat</button>
      </div>
      <div class="overlay-body">
        <video id="failVideo" controls playsinline preload="metadata">
          <source src="video.mp4" type="video/mp4" />
          Tarayƒ±cƒ±n video etiketini desteklemiyor.
        </video>
        <div class="row" style="margin-top:12px; justify-content:flex-end">
          <button class="btn" id="btnRetry" type="button">Tekrar Dene</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* helpers */
    const $ = (id) => document.getElementById(id);
    const show = (id) => {
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      $(id).classList.add("active");
      window.scrollTo({ top: 0, behavior: "instant" });
    };

    const normTR = (s) => (s || "")
      .toLowerCase()
      .replaceAll("ƒ±","i").replaceAll("ƒü","g").replaceAll("√º","u")
      .replaceAll("≈ü","s").replaceAll("√∂","o").replaceAll("√ß","c")
      .replace(/\s+/g," ")
      .trim();

    /* Q1 expected (front-end; base64) */
    const encodedQ1 = "MzAgZWtpbSAyMDI0"; // "30 ekim 2024"
    const expectedQ1 = () => atob(encodedQ1);

    const statusPill = $("statusPill");

    /* fail overlay */
    const overlay = $("overlay");
    const failVideo = $("failVideo");
    const openFail = () => {
      overlay.classList.add("show");
      try { failVideo.currentTime = 0; failVideo.play(); } catch(e){}
    };
    const closeFail = () => {
      overlay.classList.remove("show");
      try { failVideo.pause(); } catch(e){}
    };
    $("btnCloseOverlay").addEventListener("click", closeFail);
    $("btnRetry").addEventListener("click", () => {
      closeFail();
      show("screen-pass-1");
      statusPill.textContent = "Giri≈ü ‚Ä¢ 1. doƒürulama";
      $("q1").focus();
    });

    /* Screen 1 */
    $("btnQ1").addEventListener("click", () => {
      const input = normTR($("q1").value);
      const expected = normTR(expectedQ1());
      if (input === expected){
        statusPill.textContent = "Doƒürulandƒ± ‚Ä¢ Y√ºkleniyor";
        show("screen-loader");
        setTimeout(() => {
          show("screen-game");
          statusPill.textContent = "Mini-game ‚Ä¢ Kalp g√∂revi";
          startGame();
        }, 1600);
      } else {
        openFail();
      }
    });
    $("q1").addEventListener("keydown", (e) => { if (e.key === "Enter") $("btnQ1").click(); });

    /* Mini-game */
    const stageTargets = [15, 5, 1];
    let stage = 0;
    let stageClickCount = 0;
    let totalClickCount = 0;
    let spawnTimer = null;
    let activeHearts = new Map();
    let firstClickedHeartId = null;

    const heartField = $("heartField");
    const toast = $("toast");
    const uiStageLabel = $("stageLabel");
    const uiTotalClicks = $("totalClicks");

    function toastMsg(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1500);
    }
    function clearHearts(){
      if (spawnTimer) clearInterval(spawnTimer);
      spawnTimer = null;
      activeHearts.forEach(v => v.el.remove());
      activeHearts.clear();
      heartField.innerHTML = "";
    }
    function updateHUD(){
      uiStageLabel.textContent = String(stage + 1);
      uiTotalClicks.textContent = String(totalClickCount);
    }
    function rand(min,max){ return Math.random()*(max-min)+min; }
    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

    function buildHeart(id){
      const wrap = document.createElement("div");
      wrap.className = "heart-container";
      wrap.title = "Like";

      const pad = 60;
      const w = Math.max(heartField.clientWidth, 320);
      const h = Math.max(heartField.clientHeight, 320);
      wrap.style.left = `${rand(10, w - pad)}px`;
      wrap.style.top  = `${rand(10, h - pad)}px`;

      const hue = Math.floor(rand(285, 330));
      wrap.style.setProperty("--heart-color", `hsl(${hue} 95% 68%)`);

      wrap.innerHTML = `
        <input class="checkbox" type="checkbox" />
        <div class="svg-container" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" class="svg-outline" viewBox="0 0 24 24">
            <path d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Zm-3.585,18.4a2.973,2.973,0,0,1-3.83,0C4.947,16.006,2,11.87,2,8.967a4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,11,8.967a1,1,0,0,0,2,0,4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,22,8.967C22,11.87,19.053,16.006,13.915,20.313Z"></path>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" class="svg-filled" viewBox="0 0 24 24">
            <path d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Z"></path>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" height="100" width="100" class="svg-celebrate">
            <polygon points="10,10 20,20"></polygon>
            <polygon points="10,50 20,50"></polygon>
            <polygon points="20,80 30,70"></polygon>
            <polygon points="90,10 80,20"></polygon>
            <polygon points="90,50 80,50"></polygon>
            <polygon points="80,80 70,70"></polygon>
          </svg>
        </div>
      `;

      const checkbox = wrap.querySelector(".checkbox");
      checkbox.addEventListener("change", () => {
        if (!checkbox.checked) return;

        if (!firstClickedHeartId && stage === 0) firstClickedHeartId = id;

        stageClickCount++;
        totalClickCount++;
        updateHUD();

        setTimeout(() => {
          activeHearts.delete(id);
          wrap.remove();

          if (stageClickCount >= stageTargets[stage]){
            nextStage();
          }
        }, 140);
      });

      return wrap;
    }

    function spawnHeartsForStage(){
      clearHearts();
      stageClickCount = 0;
      updateHUD();

      const target = stageTargets[stage];
      for (let i=0; i<target; i++){
        const id = `${stage}-${i}-${Math.random().toString(16).slice(2)}`;
        const h = buildHeart(id);
        activeHearts.set(id, { el: h });
        heartField.appendChild(h);
      }

      // tiny drift only (avoid "broken" look)
      spawnTimer = setInterval(() => {
        const w = heartField.clientWidth;
        const h = heartField.clientHeight;
        activeHearts.forEach(({el}) => {
          const dx = rand(-1.1, 1.1);
          const dy = rand(-1.1, 1.1);
          const left = clamp((parseFloat(el.style.left||"0")+dx), 6, w-60);
          const top  = clamp((parseFloat(el.style.top ||"0")+dy), 6, h-60);
          el.style.left = `${left}px`;
          el.style.top  = `${top}px`;
        });
      }, 700);
    }

    function nextStage(){
      if (spawnTimer) clearInterval(spawnTimer);
      spawnTimer = null;

      if (stage < 2){
        toastMsg("ƒ∞lk bastƒ±ƒüƒ±nƒ± aklƒ±nda tut. Sonrakine ge√ßiyoruz.");
      } else {
        toastMsg("Son doƒürulamaya ge√ßiyoruz.");
      }

      setTimeout(() => {
        if (stage < 2){
          stage++;
          spawnHeartsForStage();
          statusPill.textContent = `Mini-game ‚Ä¢ A≈üama ${stage+1}/3`;
        } else {
          clearHearts();
          statusPill.textContent = "Doƒürulama ‚Ä¢ 2. soru";
          show("screen-pass-2");
          $("q2").focus();
        }
      }, 900);
    }

    function startGame(){
      stage = 0;
      stageClickCount = 0;
      totalClickCount = 0;
      firstClickedHeartId = null;
      updateHUD();
      spawnHeartsForStage();
      statusPill.textContent = "Mini-game ‚Ä¢ Kalp g√∂revi";
    }

    $("btnResetGame").addEventListener("click", () => {
      startGame();
      toastMsg("Mini-game sƒ±fƒ±rlandƒ±.");
    });

    /* Screen 4 (Password 2) */
    function expectedQ2Formats(){
      // Accept: 15.05.01 AND 15.5.1 (also accept separators / - / / and spaces)
      return new Set(["15.05.01", "15.5.1"]);
    }
    function normalizeDots(s){
      return (s || "")
        .toLowerCase()
        .replace(/\s+/g,"")
        .replace(/[\/\-]/g,".")
        .replace(/\.+/g,".")
        .replace(/^\./,"")
        .replace(/\.$/,"");
    }

    $("btnQ2").addEventListener("click", () => {
      const input = normalizeDots($("q2").value);

      // We don't show the answer; we just accept these formats.
      const ok = expectedQ2Formats().has(input);

      if (ok){
        $("q2Hint").textContent = "Doƒüru.";
        setTimeout(() => {
          statusPill.textContent = "Alb√ºm ‚Ä¢ 3D";
          show("screen-album");
          setAlbumSizing(); // ensure correct sizing after show
        }, 650);
      } else {
        openFail();
      }
    });
    $("q2").addEventListener("keydown", (e) => { if (e.key === "Enter") $("btnQ2").click(); });

    /* Background hearts spawner */
    const bg = $("bgHearts");
    function spawnBgHeart(){
      const h = document.createElement("div");
      h.className = "bg-heart";

      const size = rand(10, 18);
      h.style.width = `${size}px`;
      h.style.height = `${size}px`;

      // Keep pseudo-elements consistent: use inline style sheet variables via scale
      // (pseudo-elements stay 14px; to prevent mismatch, we scale the whole node)
      const scale = size / 14;
      const dur = rand(6, 12);
      const drift = Math.floor(rand(-18, 18));

      h.style.transform = `rotate(-45deg) scale(${scale})`;
      h.style.setProperty("--dur", `${dur}s`);
      h.style.setProperty("--drift", `${drift}vw`);
      h.style.left = `${rand(0, 100)}vw`;
      h.style.bottom = `-30px`;
      h.style.opacity = String(rand(.22,.78));

      bg.appendChild(h);
      setTimeout(() => h.remove(), dur*1000 + 800);
    }
    setInterval(spawnBgHeart, 280);

    /* Responsive sizing for album so photos don't overlap */
    function setAlbumSizing(){
      const scene = document.querySelector(".carousel-scene");
      if (!scene) return;

      const vw = Math.min(window.innerWidth, 980);
      // Choose a card size that stays separated and centered
      const slideW = Math.max(190, Math.min(280, Math.floor(vw * 0.34)));
      const slideH = Math.floor(slideW * 1.28);

      // ringZ determines spacing: bigger = more separation
      const ringZ = Math.max(210, Math.min(360, Math.floor(slideW * 1.05)));

      document.documentElement.style.setProperty("--slideW", slideW + "px");
      document.documentElement.style.setProperty("--slideH", slideH + "px");
      document.documentElement.style.setProperty("--ringZ", ringZ + "px");
    }
    window.addEventListener("resize", setAlbumSizing);

    statusPill.textContent = "Giri≈ü ‚Ä¢ 1. doƒürulama";
    setAlbumSizing();
  </script>
</body>
</html>
